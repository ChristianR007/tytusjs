class NodeTree{constructor(t=null,e="",r=[]){this.id=Math.random().toString(15).substr(3,12),this.tag=e,this.value=t,this.childs=r}}class Feature{constructor(t,e,r){this.attribute=t,this.entropy=-1,this.gain=-1,this.primaryCount=0,this.secondaryCount=0,this.primaryPosibility=e,this.secondPosibility=r}updateFeature(t){if(t===this.primaryPosibility)this.primaryCount+=1;else{if(t!==this.secondPosibility)return!1;this.secondaryCount+=1}return this.entropy=this.calculateEntropy(this.primaryCount,this.secondaryCount),!0}calculateEntropy(t,e){let r=-1;return 0==t||0==e?0:(r=-t/(t+e)*Math.log2(t/(t+e)),r+=-e/(t+e)*Math.log2(e/(t+e)))}}class Attribute{constructor(t){this.attribute=t,this.features=[],this.infoEntropy=-1,this.gain=-1,this.index=-1}}class DecisionTreeID3{constructor(t=[]){this.dataset=t,this.generalEntropy=-1,this.primaryCount=-1,this.secondaryCount=-1,this.primaryPosibility="",this.secondPosibility="",this.root=null}calculateEntropy(t,e){let r=-1;return 0==t||0==e?0:(r=-t/(t+e)*Math.log2(t/(t+e)),r+=-e/(t+e)*Math.log2(e/(t+e)))}train(t,e=0){let r=t[0].length-1;this.calculateGeneralEntropy(t,r);let s=t[0].length,o=[];for(let i=e;i<s;i++){if(i===r)continue;let e=new Attribute(t[0][i]);e.index=i,e.features=this.classifierFeatures(t,i,r),e.infoEntropy=this.calculateInformationEntropy(e.features),e.gain=this.calculateGain(this.generalEntropy,e.infoEntropy),o.push(e)}if(0==o.length)return null;let i=this.selectBestFeature(o),n=new NodeTree(o[i].attribute);return o[i].features.map(r=>{let s=new NodeTree(null);if(0==r.entropy)s.value=0==r.primaryCount?r.secondPosibility:r.primaryPosibility;else{let n=t.filter((t,e)=>t[o[i].index]===r.attribute||0==e);e<4&&n.length>2&&(s=this.train(n,e+1))}s.tag=r.attribute,n.childs.push(s)}),n}predict(t,e){return this.recursivePredict(t,e)}recursivePredict(t,e){if(0==e.childs.length)return e;for(let r=0;r<t[0].length;r++)if(t[0][r]===e.value)for(let s=0;s<e.childs.length;s++)if(e.childs[s].tag===t[1][r])return this.recursivePredict(t,e.childs[s]);return null}calculateGeneralEntropy(t,e){let r={tag:"",count:0},s={tag:"",count:0},o=!1;return t.map(t=>{o?r.tag?s.tag||t[e]==r.tag?r.tag===t[e]?r.count+=1:s.tag===t[e]&&(s.count+=1):(s.tag=t[e],s.count+=1):(r.tag=t[e],r.count+=1):o=!0}),this.primaryPosibility=r.tag,this.secondPosibility=s.tag,this.primaryCount=r.count,this.secondaryCount=s.count,this.generalEntropy=this.calculateEntropy(r.count,s.count),this.generalEntropy}classifierFeatures(t,e,r){let s=[],o=!1;return t.map(t=>{if(o){let o=s.findIndex(r=>r.attribute===t[e]);if(o>-1)s[o].updateFeature(t[r]);else{let o=new Feature(t[e],this.primaryPosibility,this.secondPosibility);o.updateFeature(t[r]),s.push(o)}}else o=!0}),s}calculateInformationEntropy(t){let e=0;return t.map(t=>{e+=(t.primaryCount+t.secondaryCount)/(this.primaryCount+this.secondaryCount)*t.entropy}),e}calculateGain(t,e){return t-e}selectBestFeature(t){let e=-1,r=-1e3;return t.map((t,s)=>{t.gain>r&&(r=t.gain,e=s)}),e}generateDotString(t){let e="{";return(e+=this.recursiveDotString(t))+"}"}recursiveDotString(t,e=""){let r="";return t?(r+=`${t.id} [label="${t.value}"];`,r+=e?`${e}--${t.id}`:"",r+=t.tag?`[label="${t.tag}"];`:"",t.childs.map(e=>{r+=this.recursiveDotString(e,t.id)}),r):""}}class PolynomialModel{constructor(){this.isFit=!1}}class PolynomialRegression extends PolynomialModel{constructor(){super(),this.solutions=[],this.error=0}fit(t,e,r){let s=r+1,o=r+2,i=new Array(s);for(let t=0;t<s;t++)i[t]=new Array(o);for(let r=0;r<s;r++)for(let s=0;s<o;s++){let n=0;if(0==r&&0==s)n=t.length;else if(s==o-1)for(let s=0;s<t.length;s++)n+=Math.pow(t[s],r)*e[s];else for(let e=0;e<t.length;e++)n+=Math.pow(t[e],s+r);i[r][s]=n}for(let t=1;t<s;t++)for(let e=0;e<=t-1;e++){let r=i[t][e]/i[e][e];for(let s=e;s<o;s++)i[t][s]=i[t][s]-r*i[e][s]}for(let t=s-1;t>-1;t--)for(let e=s-1;e>-1;e--)t==e?i[t][o-1]=i[t][o-1]/i[t][e]:0!=i[t][e]&&(i[t][o-1]-=i[t][e]*i[e][o-1]);this.solutions=new Array(s);for(let t=0;t<s;t++)this.solutions[t]=i[t][o-1];this.isFit=!0,this.calculateR2(t,e)}predict(t){let e=[];if(this.isFit)for(let r=0;r<t.length;r++){let s=0;for(let e=0;e<this.solutions.length;e++)s+=this.solutions[e]*Math.pow(t[r],e);e.push(s)}return e}calculateR2(t,e){let r=new Array(t.length),s=this.predict(t),o=0;for(let i=0;i<t.length;i++)o+=e[i],r[i]=Math.pow(e[i]-s[i],2);let i=0,n=0;for(let s=0;s<t.length;s++)i+=r[s],n+=Math.pow(e[s]-o/t.length,2);let h=(n-i)/n;this.error=h}getError(){return this.error}}class LinearModel{constructor(){this.isFit=!1}}class LinearRegression extends LinearModel{constructor(){super(),this.m=0,this.b=0}fit(t,e){for(var r=0,s=0,o=0,i=0,n=0;n<t.length;n++)r+=t[n],s+=e[n],o+=t[n]*e[n],i+=t[n]*t[n];this.m=(t.length*o-r*s)/(t.length*i-Math.pow(Math.abs(r),2)),this.b=(s*i-r*o)/(t.length*i-Math.pow(Math.abs(r),2)),this.isFit=!0}predict(t){var e=[];if(this.isFit)for(var r=0;r<t.length;r++)e.push(this.m*t[r]+this.b);return e}mserror(t,e){for(var r=0,s=0;s<t.length;s++)r+=Math.pow(t[s]-e[s],2);return r/t.length}}class KNearestNeighbor{constructor(t=[]){this.individuals=t}euclidean(t){var e=[],r=this.individuals[0].length-1;for(const o of this.individuals){var s=o.slice(0,r);e.push(euclidean(t,s))}let o=Math.min(...e),i=[];for(const t in e)e[t]==o&&i.push(this.individuals[t][r]);return[...new Set(i)]}manhattan(t){var e=[],r=this.individuals[0].length-1;for(const o of this.individuals){var s=o.slice(0,r);e.push(manhattan(t,s))}let o=Math.min(...e),i=[];for(const t in e)e[t]==o&&i.push(this.individuals[t][r]);return[...new Set(i)]}}class FuzzySet{constructor(t=[]){this.individuals=t,this.minsAndMaxs=this.calculateMinsAndMax()}calculateMinsAndMax(){var t=[[],[],[]],e=this.individuals[0].length-1;for(let r=0;r<this.individuals.length;r++)for(let s=0;s<e;s++)null==t[s][0]?t[s][0]=this.individuals[r][s]:t[s][0]=Math.min(t[s][0],this.individuals[r][s]),null==t[s][1]?t[s][1]=this.individuals[r][s]:t[s][1]=Math.max(t[s][1],this.individuals[r][s]);return t}normalization(){var t=[],e=this.individuals[0].length-1;for(let r=0;r<this.individuals.length;r++){let s=[];for(let t=0;t<e;t++)this.individuals[r][t]<=this.minsAndMaxs[t][0]?s.push(0):this.individuals[r][t]>=this.minsAndMaxs[t][1]?s.push(1):s.push(((this.individuals[r][t]-this.minsAndMaxs[t][0])/(this.minsAndMaxs[t][1]-this.minsAndMaxs[t][0])).toFixed(5));t.push(s)}return t}euclidean(t){var e=this.individuals[0].length-1,r=this.normalization(),s=[];for(let e=0;e<t.length;e++)t[e]<=this.minsAndMaxs[e][0]?s.push(0):t[e]>=this.minsAndMaxs[e][1]?s.push(1):s.push(((t[e]-this.minsAndMaxs[e][0])/(this.minsAndMaxs[e][1]-this.minsAndMaxs[e][0])).toFixed(5));var o=[];for(const t of r){var i=t.slice(0,e);o.push(euclidean(s,i))}let n=Math.min(...o),h=[];for(const t in o)o[t]==n&&h.push(this.individuals[t][e]);return[...new Set(h)]}manhattan(t){var e=this.individuals[0].length-1,r=this.normalization(),s=[];for(let e=0;e<t.length;e++)t[e]<=this.minsAndMaxs[e][0]?s.push(0):t[e]>=this.minsAndMaxs[e][1]?s.push(1):s.push(((t[e]-this.minsAndMaxs[e][0])/(this.minsAndMaxs[e][1]-this.minsAndMaxs[e][0])).toFixed(5));var o=[];for(const t of r){var i=t.slice(0,e);o.push(manhattan(s,i))}let n=Math.min(...o),h=[];for(const t in o)o[t]==n&&h.push(this.individuals[t][e]);return[...new Set(h)]}}class KMeans{constructor(){this.k=3}}class LinearKMeans extends KMeans{constructor(){super(),this.data=[]}clusterize(t,e,r){let s=[];this.data=e;for(let o=0;o<r;o++){let r=[];for(let s=0;s<t;s++){let t=e[Math.floor(Math.random()*e.length)];for(;-1!=r.findIndex(e=>e===t);)t=e[Math.floor(Math.random()*e.length)];r.push(t)}r=r.sort(function(t,e){return t>e?1:e>t?-1:0});let o=[],i=[],n=0,h=0,l=!0;e.forEach(t=>{n=0,h=0,l=!0,r.forEach(e=>{let r=this.distance(t,e);l?(h=Math.abs(r),n=e,l=!l):Math.abs(r)<h&&(h=Math.abs(r),n=e),o.push([t,e,r])}),i.push([t,n,h])});let a=[],u=0,c=[];do{a=c,c=[],u=0,r.forEach((t,e)=>{let s=i.filter(e=>e[1]==t).map(t=>t[0]);c.push(this.calculateMeanVariance(s)),u+=s[1],r[e]=c[e][0]}),Number.isNaN(u)&&(u=0),o=[],i=[],n=0,h=0,l=!0,e.forEach(t=>{n=0,h=0,l=!0,r.forEach(e=>{let r=this.distance(t,e);l?(h=Math.abs(r),n=e,l=!l):Math.abs(r)<h&&(h=Math.abs(r),n=e),o.push([t,e,r])}),i.push([t,n,h])})}while(JSON.stringify(a)!=JSON.stringify(c));s.push([u,r,i])}return s.sort(function(t,e){return t[0]>e[0]?1:e[0]>t[0]?-1:0}),s[0][2]}distance(t,e){return e-t}calculateMeanVariance(t){var e=t.reduce(function(t,e){return t+e}),r=function(t,e){return t.reduce(function(t,r){return t+Math.pow(r-e,2)},0)}(t,e/t.length),s={mean:e/t.length,variance:r/t.length};return[s.mean,s.variance]}}function joinArrays(){var t=[];if(6==arguments.length){t.push([arguments[0],arguments[2],arguments[4]]);for(var e=0;e<arguments[1].length;e++)t.push([arguments[1][e],arguments[3][e],arguments[5][e]])}return t}function zip(t){return t[0].map(function(e,r){return t.map(function(t){return t[r]})})}function euclidean(t,e){for(var r=0,s=0;s<t.length;s++)r+=Math.pow(t[s]-e[s],2);return Math.sqrt(r).toFixed(5)}function manhattan(t,e){for(var r=0,s=0;s<t.length;s++)r+=Math.abs(t[s]-e[s]);return r}class PLS{constructor(t,e){if(!0===t)this.meanX=e.meanX,this.stdDevX=e.stdDevX,this.meanY=e.meanY,this.stdDevY=e.stdDevY,this.PBQ=Matrix.checkMatrix(e.PBQ),this.R2X=e.R2X,this.scale=e.scale,this.scaleMethod=e.scaleMethod,this.tolerance=e.tolerance;else{let{tolerance:e=1e-5,scale:r=!0}=t;this.tolerance=e,this.scale=r,this.latentVectors=t.latentVectors}}train(t,e){if(t=Matrix.checkMatrix(t),e=Matrix.checkMatrix(e),t.length!==e.length)throw new RangeError("The number of X rows must be equal to the number of Y rows");this.meanX=t.mean("column"),this.stdDevX=t.standardDeviation("column",{mean:this.meanX,unbiased:!0}),this.meanY=e.mean("column"),this.stdDevY=e.standardDeviation("column",{mean:this.meanY,unbiased:!0}),this.scale&&(t=t.clone().subRowVector(this.meanX).divRowVector(this.stdDevX),e=e.clone().subRowVector(this.meanY).divRowVector(this.stdDevY)),void 0===this.latentVectors&&(this.latentVectors=Math.min(t.rows-1,t.columns));let r,s,o,i,n=t.rows,h=t.columns,l=e.rows,a=e.columns,u=t.clone().mul(t).sum(),c=e.clone().mul(e).sum(),f=this.tolerance,m=this.latentVectors,w=Matrix.zeros(n,m),p=Matrix.zeros(h,m),g=Matrix.zeros(l,m),d=Matrix.zeros(a,m),y=Matrix.zeros(m,m),M=p.clone(),b=0;for(;norm(e)>f&&b<m;){let h=t.transpose(),l=e.transpose(),a=maxSumColIndex(t.clone().mul(t)),u=maxSumColIndex(e.clone().mul(e)),c=t.getColumnVector(a),m=e.getColumnVector(u);for(r=Matrix.zeros(n,1);norm(c.clone().sub(r))>f;)(s=h.mmul(m)).div(norm(s)),r=c,c=t.mmul(s),(o=l.mmul(c)).div(norm(o)),m=e.mmul(o);r=c;let x=h.mmul(r),v=r.transpose().mmul(r).get(0,0),R=norm(i=x.div(v));i.div(R),r.mul(R),s.mul(R),x=m.transpose().mmul(r),v=r.transpose().mmul(r).get(0,0);let k=x.div(v).get(0,0);t.sub(r.mmul(i.transpose())),e.sub(r.clone().mul(k).mmul(o.transpose())),w.setColumn(b,r),p.setColumn(b,i),g.setColumn(b,m),d.setColumn(b,o),M.setColumn(b,s),y.set(b,b,k),b++}b--,w=w.subMatrix(0,w.rows-1,0,b),p=p.subMatrix(0,p.rows-1,0,b),g=g.subMatrix(0,g.rows-1,0,b),d=d.subMatrix(0,d.rows-1,0,b),M=M.subMatrix(0,M.rows-1,0,b),y=y.subMatrix(0,b,0,b),this.ssqYcal=c,this.E=t,this.F=e,this.T=w,this.P=p,this.U=g,this.Q=d,this.W=M,this.B=y,this.PBQ=p.mmul(y).mmul(d.transpose()),this.R2X=r.transpose().mmul(r).mmul(i.transpose().mmul(i)).div(u).get(0,0)}predict(t){let e=Matrix.checkMatrix(t);this.scale&&(e=e.subRowVector(this.meanX).divRowVector(this.stdDevX));let r=e.mmul(this.PBQ);return r.mulRowVector(this.stdDevY).addRowVector(this.meanY)}getExplainedVariance(){return this.R2X}toJSON(){return{name:"PLS",R2X:this.R2X,meanX:this.meanX,stdDevX:this.stdDevX,meanY:this.meanY,stdDevY:this.stdDevY,PBQ:this.PBQ,tolerance:this.tolerance,scale:this.scale}}static load(t){if("PLS"!==t.name)throw new RangeError(`Invalid model: ${t.name}`);return new PLS(!0,t)}}function maxSumColIndex(t){return Matrix.rowVector(t.sum("column")).maxIndex()[0]}function norm(t){return Math.sqrt(t.clone().apply(pow2array).sum())}function pow2array(t,e){this.set(t,e,this.get(t,e)**2)}function featureNormalize(t){let e=t.mean("column"),r=t.standardDeviation("column",{mean:e,unbiased:!0});return{result:Matrix.checkMatrix(t).subRowVector(e).divRowVector(r),means:e,std:r}}function initializeMatrices(t,e){if(e)for(let e=0;e<t.length;++e)for(let r=0;r<t[e].length;++r){let s=t[e][r];t[e][r]=null!==s?new Matrix(t[e][r]):void 0}else for(let e=0;e<t.length;++e)t[e]=new Matrix(t[e]);return t}class AbstractMatrix{static from1DArray(t,e,r){if(t*e!==r.length)throw new RangeError("data length does not match given dimensions");let s=new Matrix(t,e);for(let o=0;o<t;o++)for(let t=0;t<e;t++)s.set(o,t,r[o*e+t]);return s}static rowVector(t){let e=new Matrix(1,t.length);for(let r=0;r<t.length;r++)e.set(0,r,t[r]);return e}static columnVector(t){let e=new Matrix(t.length,1);for(let r=0;r<t.length;r++)e.set(r,0,t[r]);return e}static zeros(t,e){return new Matrix(t,e)}static ones(t,e){return new Matrix(t,e).fill(1)}static rand(t,e,r={}){if("object"!=typeof r)throw new TypeError("options must be an object");const{random:s=Math.random}=r;let o=new Matrix(t,e);for(let r=0;r<t;r++)for(let t=0;t<e;t++)o.set(r,t,s());return o}static randInt(t,e,r={}){if("object"!=typeof r)throw new TypeError("options must be an object");const{min:s=0,max:o=1e3,random:i=Math.random}=r;if(!Number.isInteger(s))throw new TypeError("min must be an integer");if(!Number.isInteger(o))throw new TypeError("max must be an integer");if(s>=o)throw new RangeError("min must be smaller than max");let n=o-s,h=new Matrix(t,e);for(let r=0;r<t;r++)for(let t=0;t<e;t++){let e=s+Math.round(i()*n);h.set(r,t,e)}return h}static eye(t,e,r){void 0===e&&(e=t),void 0===r&&(r=1);let s=Math.min(t,e),o=this.zeros(t,e);for(let t=0;t<s;t++)o.set(t,t,r);return o}static diag(t,e,r){let s=t.length;void 0===e&&(e=s),void 0===r&&(r=e);let o=Math.min(s,e,r),i=this.zeros(e,r);for(let e=0;e<o;e++)i.set(e,e,t[e]);return i}static min(t,e){t=this.checkMatrix(t),e=this.checkMatrix(e);let r=t.rows,s=t.columns,o=new Matrix(r,s);for(let i=0;i<r;i++)for(let r=0;r<s;r++)o.set(i,r,Math.min(t.get(i,r),e.get(i,r)));return o}static max(t,e){t=this.checkMatrix(t),e=this.checkMatrix(e);let r=t.rows,s=t.columns,o=new this(r,s);for(let i=0;i<r;i++)for(let r=0;r<s;r++)o.set(i,r,Math.max(t.get(i,r),e.get(i,r)));return o}static checkMatrix(t){return AbstractMatrix.isMatrix(t)?t:new Matrix(t)}static isMatrix(t){return null!=t&&"Matrix"===t.klass}get size(){return this.rows*this.columns}apply(t){if("function"!=typeof t)throw new TypeError("callback must be a function");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)t.call(this,e,r);return this}to1DArray(){let t=[];for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)t.push(this.get(e,r));return t}to2DArray(){let t=[];for(let e=0;e<this.rows;e++){t.push([]);for(let r=0;r<this.columns;r++)t[e].push(this.get(e,r))}return t}toJSON(){return this.to2DArray()}isRowVector(){return 1===this.rows}isColumnVector(){return 1===this.columns}isVector(){return 1===this.rows||1===this.columns}isSquare(){return this.rows===this.columns}isEmpty(){return 0===this.rows||0===this.columns}isSymmetric(){if(this.isSquare()){for(let t=0;t<this.rows;t++)for(let e=0;e<=t;e++)if(this.get(t,e)!==this.get(e,t))return!1;return!0}return!1}isEchelonForm(){let t=0,e=0,r=-1,s=!0,o=!1;for(;t<this.rows&&s;){for(e=0,o=!1;e<this.columns&&!1===o;)0===this.get(t,e)?e++:1===this.get(t,e)&&e>r?(o=!0,r=e):(s=!1,o=!0);t++}return s}isReducedEchelonForm(){let t=0,e=0,r=-1,s=!0,o=!1;for(;t<this.rows&&s;){for(e=0,o=!1;e<this.columns&&!1===o;)0===this.get(t,e)?e++:1===this.get(t,e)&&e>r?(o=!0,r=e):(s=!1,o=!0);for(let r=e+1;r<this.rows;r++)0!==this.get(t,r)&&(s=!1);t++}return s}echelonForm(){let t=this.clone(),e=0,r=0;for(;e<t.rows&&r<t.columns;){let s=e;for(let o=e;o<t.rows;o++)t.get(o,r)>t.get(s,r)&&(s=o);if(0===t.get(s,r))r++;else{t.swapRows(e,s);let o=t.get(e,r);for(let s=r;s<t.columns;s++)t.set(e,s,t.get(e,s)/o);for(let s=e+1;s<t.rows;s++){let o=t.get(s,r)/t.get(e,r);t.set(s,r,0);for(let i=r+1;i<t.columns;i++)t.set(s,i,t.get(s,i)-t.get(e,i)*o)}e++,r++}}return t}reducedEchelonForm(){let t=this.echelonForm(),e=t.columns,r=t.rows,s=r-1;for(;s>=0;)if(0===t.maxRow(s))s--;else{let o=0,i=!1;for(;o<r&&!1===i;)1===t.get(s,o)?i=!0:o++;for(let r=0;r<s;r++){let i=t.get(r,o);for(let n=o;n<e;n++){let e=t.get(r,n)-i*t.get(s,n);t.set(r,n,e)}}s--}return t}set(){throw new Error("set method is unimplemented")}get(){throw new Error("get method is unimplemented")}repeat(t={}){if("object"!=typeof t)throw new TypeError("options must be an object");const{rows:e=1,columns:r=1}=t;if(!Number.isInteger(e)||e<=0)throw new TypeError("rows must be a positive integer");if(!Number.isInteger(r)||r<=0)throw new TypeError("columns must be a positive integer");let s=new Matrix(this.rows*e,this.columns*r);for(let t=0;t<e;t++)for(let e=0;e<r;e++)s.setSubMatrix(this,this.rows*t,this.columns*e);return s}fill(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,t);return this}neg(){return this.mulS(-1)}getRow(t){checkRowIndex(this,t);let e=[];for(let r=0;r<this.columns;r++)e.push(this.get(t,r));return e}getRowVector(t){return Matrix.rowVector(this.getRow(t))}setRow(t,e){checkRowIndex(this,t),e=checkRowVector(this,e);for(let r=0;r<this.columns;r++)this.set(t,r,e[r]);return this}swapRows(t,e){checkRowIndex(this,t),checkRowIndex(this,e);for(let r=0;r<this.columns;r++){let s=this.get(t,r);this.set(t,r,this.get(e,r)),this.set(e,r,s)}return this}getColumn(t){checkColumnIndex(this,t);let e=[];for(let r=0;r<this.rows;r++)e.push(this.get(r,t));return e}getColumnVector(t){return Matrix.columnVector(this.getColumn(t))}setColumn(t,e){checkColumnIndex(this,t),e=checkColumnVector(this,e);for(let r=0;r<this.rows;r++)this.set(r,t,e[r]);return this}swapColumns(t,e){checkColumnIndex(this,t),checkColumnIndex(this,e);for(let r=0;r<this.rows;r++){let s=this.get(r,t);this.set(r,t,this.get(r,e)),this.set(r,e,s)}return this}addRowVector(t){t=checkRowVector(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)+t[r]);return this}subRowVector(t){t=checkRowVector(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)-t[r]);return this}mulRowVector(t){t=checkRowVector(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)*t[r]);return this}divRowVector(t){t=checkRowVector(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)/t[r]);return this}addColumnVector(t){t=checkColumnVector(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)+t[e]);return this}subColumnVector(t){t=checkColumnVector(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)-t[e]);return this}mulColumnVector(t){t=checkColumnVector(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)*t[e]);return this}divColumnVector(t){t=checkColumnVector(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)/t[e]);return this}mulRow(t,e){checkRowIndex(this,t);for(let r=0;r<this.columns;r++)this.set(t,r,this.get(t,r)*e);return this}mulColumn(t,e){checkColumnIndex(this,t);for(let r=0;r<this.rows;r++)this.set(r,t,this.get(r,t)*e);return this}max(){if(this.isEmpty())return NaN;let t=this.get(0,0);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.get(e,r)>t&&(t=this.get(e,r));return t}maxIndex(){checkNonEmpty(this);let t=this.get(0,0),e=[0,0];for(let r=0;r<this.rows;r++)for(let s=0;s<this.columns;s++)this.get(r,s)>t&&(t=this.get(r,s),e[0]=r,e[1]=s);return e}min(){if(this.isEmpty())return NaN;let t=this.get(0,0);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.get(e,r)<t&&(t=this.get(e,r));return t}minIndex(){checkNonEmpty(this);let t=this.get(0,0),e=[0,0];for(let r=0;r<this.rows;r++)for(let s=0;s<this.columns;s++)this.get(r,s)<t&&(t=this.get(r,s),e[0]=r,e[1]=s);return e}maxRow(t){if(checkRowIndex(this,t),this.isEmpty())return NaN;let e=this.get(t,0);for(let r=1;r<this.columns;r++)this.get(t,r)>e&&(e=this.get(t,r));return e}maxRowIndex(t){checkRowIndex(this,t),checkNonEmpty(this);let e=this.get(t,0),r=[t,0];for(let s=1;s<this.columns;s++)this.get(t,s)>e&&(e=this.get(t,s),r[1]=s);return r}minRow(t){if(checkRowIndex(this,t),this.isEmpty())return NaN;let e=this.get(t,0);for(let r=1;r<this.columns;r++)this.get(t,r)<e&&(e=this.get(t,r));return e}minRowIndex(t){checkRowIndex(this,t),checkNonEmpty(this);let e=this.get(t,0),r=[t,0];for(let s=1;s<this.columns;s++)this.get(t,s)<e&&(e=this.get(t,s),r[1]=s);return r}maxColumn(t){if(checkColumnIndex(this,t),this.isEmpty())return NaN;let e=this.get(0,t);for(let r=1;r<this.rows;r++)this.get(r,t)>e&&(e=this.get(r,t));return e}maxColumnIndex(t){checkColumnIndex(this,t),checkNonEmpty(this);let e=this.get(0,t),r=[0,t];for(let s=1;s<this.rows;s++)this.get(s,t)>e&&(e=this.get(s,t),r[0]=s);return r}minColumn(t){if(checkColumnIndex(this,t),this.isEmpty())return NaN;let e=this.get(0,t);for(let r=1;r<this.rows;r++)this.get(r,t)<e&&(e=this.get(r,t));return e}minColumnIndex(t){checkColumnIndex(this,t),checkNonEmpty(this);let e=this.get(0,t),r=[0,t];for(let s=1;s<this.rows;s++)this.get(s,t)<e&&(e=this.get(s,t),r[0]=s);return r}diag(){let t=Math.min(this.rows,this.columns),e=[];for(let r=0;r<t;r++)e.push(this.get(r,r));return e}norm(t="frobenius"){let e=0;if("max"===t)return this.max();if("frobenius"===t){for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)e+=this.get(t,r)*this.get(t,r);return Math.sqrt(e)}throw new RangeError(`unknown norm type: ${t}`)}cumulativeSum(){let t=0;for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)t+=this.get(e,r),this.set(e,r,t);return this}dot(t){AbstractMatrix.isMatrix(t)&&(t=t.to1DArray());let e=this.to1DArray();if(e.length!==t.length)throw new RangeError("vectors do not have the same size");let r=0;for(let s=0;s<e.length;s++)r+=e[s]*t[s];return r}mmul(t){t=Matrix.checkMatrix(t);let e=this.rows,r=this.columns,s=t.columns,o=new Matrix(e,s),i=new Float64Array(r);for(let n=0;n<s;n++){for(let e=0;e<r;e++)i[e]=t.get(e,n);for(let t=0;t<e;t++){let e=0;for(let s=0;s<r;s++)e+=this.get(t,s)*i[s];o.set(t,n,e)}}return o}strassen2x2(t){t=Matrix.checkMatrix(t);let e=new Matrix(2,2);const r=this.get(0,0),s=t.get(0,0),o=this.get(0,1),i=t.get(0,1),n=this.get(1,0),h=t.get(1,0),l=this.get(1,1),a=t.get(1,1),u=(r+l)*(s+a),c=(n+l)*s,f=r*(i-a),m=l*(h-s),w=(r+o)*a,p=u+m-w+(o-l)*(h+a),g=f+w,d=c+m,y=u-c+f+(n-r)*(s+i);return e.set(0,0,p),e.set(0,1,g),e.set(1,0,d),e.set(1,1,y),e}strassen3x3(t){t=Matrix.checkMatrix(t);let e=new Matrix(3,3);const r=this.get(0,0),s=this.get(0,1),o=this.get(0,2),i=this.get(1,0),n=this.get(1,1),h=this.get(1,2),l=this.get(2,0),a=this.get(2,1),u=this.get(2,2),c=t.get(0,0),f=t.get(0,1),m=t.get(0,2),w=t.get(1,0),p=t.get(1,1),g=t.get(1,2),d=t.get(2,0),y=t.get(2,1),M=t.get(2,2),b=(r-i)*(-f+p),x=(-r+i+n)*(c-f+p),v=(i+n)*(-c+f),R=r*c,k=(-r+l+a)*(c-m+g),S=(-r+l)*(m-g),A=(l+a)*(-c+m),E=(-o+a+u)*(p+d-y),C=(o-u)*(p-y),N=o*d,I=(a+u)*(-d+y),T=(-o+n+h)*(g+d-M),V=(o-h)*(g-M),D=(n+h)*(-d+M),j=R+N+s*w,P=(r+s+o-i-n-a-u)*p+x+v+R+E+N+I,F=R+k+A+(r+s+o-n-h-l-a)*g+N+T+D,z=b+n*(-c+f+w-p-g-d+M)+x+R+N+T+V,B=b+x+v+R+h*y,$=N+T+V+D+i*m,q=R+k+S+a*(-c+m+w-p-g-d+y)+E+C+N,X=E+C+N+I+l*f,O=R+k+S+A+u*M;return e.set(0,0,j),e.set(0,1,P),e.set(0,2,F),e.set(1,0,z),e.set(1,1,B),e.set(1,2,$),e.set(2,0,q),e.set(2,1,X),e.set(2,2,O),e}mmulStrassen(t){t=Matrix.checkMatrix(t);let e=this.clone(),r=e.rows,s=e.columns,o=t.rows,i=t.columns;function n(t,e,r){let s=t.rows,o=t.columns;if(s===e&&o===r)return t;{let s=AbstractMatrix.zeros(e,r);return s=s.setSubMatrix(t,0,0)}}s!==o&&console.warn(`Multiplying ${r} x ${s} and ${o} x ${i} matrix: dimensions do not match.`);let h=Math.max(r,o),l=Math.max(s,i);return function t(e,r,s,o){if(s<=512||o<=512)return e.mmul(r);s%2==1&&o%2==1?(e=n(e,s+1,o+1),r=n(r,s+1,o+1)):s%2==1?(e=n(e,s+1,o),r=n(r,s+1,o)):o%2==1&&(e=n(e,s,o+1),r=n(r,s,o+1));let i=parseInt(e.rows/2,10),h=parseInt(e.columns/2,10),l=e.subMatrix(0,i-1,0,h-1),a=r.subMatrix(0,i-1,0,h-1),u=e.subMatrix(0,i-1,h,e.columns-1),c=r.subMatrix(0,i-1,h,r.columns-1),f=e.subMatrix(i,e.rows-1,0,h-1),m=r.subMatrix(i,r.rows-1,0,h-1),w=e.subMatrix(i,e.rows-1,h,e.columns-1),p=r.subMatrix(i,r.rows-1,h,r.columns-1),g=t(AbstractMatrix.add(l,w),AbstractMatrix.add(a,p),i,h),d=t(AbstractMatrix.add(f,w),a,i,h),y=t(l,AbstractMatrix.sub(c,p),i,h),M=t(w,AbstractMatrix.sub(m,a),i,h),b=t(AbstractMatrix.add(l,u),p,i,h),x=t(AbstractMatrix.sub(f,l),AbstractMatrix.add(a,c),i,h),v=t(AbstractMatrix.sub(u,w),AbstractMatrix.add(m,p),i,h),R=AbstractMatrix.add(g,M);R.sub(b),R.add(v);let k=AbstractMatrix.add(y,b),S=AbstractMatrix.add(d,M),A=AbstractMatrix.sub(g,d);A.add(y),A.add(x);let E=AbstractMatrix.zeros(2*R.rows,2*R.columns);return(E=(E=(E=(E=E.setSubMatrix(R,0,0)).setSubMatrix(k,R.rows,0)).setSubMatrix(S,0,R.columns)).setSubMatrix(A,R.rows,R.columns)).subMatrix(0,s-1,0,o-1)}(e=n(e,h,l),t=n(t,h,l),h,l)}scaleRows(t={}){if("object"!=typeof t)throw new TypeError("options must be an object");const{min:e=0,max:r=1}=t;if(!Number.isFinite(e))throw new TypeError("min must be a number");if(!Number.isFinite(r))throw new TypeError("max must be a number");if(e>=r)throw new RangeError("min must be smaller than max");let s=new Matrix(this.rows,this.columns);for(let t=0;t<this.rows;t++){const o=this.getRow(t);o.length>0&&rescale(o,{min:e,max:r,output:o}),s.setRow(t,o)}return s}scaleColumns(t={}){if("object"!=typeof t)throw new TypeError("options must be an object");const{min:e=0,max:r=1}=t;if(!Number.isFinite(e))throw new TypeError("min must be a number");if(!Number.isFinite(r))throw new TypeError("max must be a number");if(e>=r)throw new RangeError("min must be smaller than max");let s=new Matrix(this.rows,this.columns);for(let t=0;t<this.columns;t++){const o=this.getColumn(t);o.length&&rescale(o,{min:e,max:r,output:o}),s.setColumn(t,o)}return s}flipRows(){const t=Math.ceil(this.columns/2);for(let e=0;e<this.rows;e++)for(let r=0;r<t;r++){let t=this.get(e,r),s=this.get(e,this.columns-1-r);this.set(e,r,s),this.set(e,this.columns-1-r,t)}return this}flipColumns(){const t=Math.ceil(this.rows/2);for(let e=0;e<this.columns;e++)for(let r=0;r<t;r++){let t=this.get(r,e),s=this.get(this.rows-1-r,e);this.set(r,e,s),this.set(this.rows-1-r,e,t)}return this}kroneckerProduct(t){t=Matrix.checkMatrix(t);let e=this.rows,r=this.columns,s=t.rows,o=t.columns,i=new Matrix(e*s,r*o);for(let n=0;n<e;n++)for(let e=0;e<r;e++)for(let r=0;r<s;r++)for(let h=0;h<o;h++)i.set(s*n+r,o*e+h,this.get(n,e)*t.get(r,h));return i}kroneckerSum(t){if(t=Matrix.checkMatrix(t),!this.isSquare()||!t.isSquare())throw new Error("Kronecker Sum needs two Square Matrices");let e=this.rows,r=t.rows,s=this.kroneckerProduct(Matrix.eye(r,r)),o=Matrix.eye(e,e).kroneckerProduct(t);return s.add(o)}transpose(){let t=new Matrix(this.columns,this.rows);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)t.set(r,e,this.get(e,r));return t}sortRows(t=compareNumbers){for(let e=0;e<this.rows;e++)this.setRow(e,this.getRow(e).sort(t));return this}sortColumns(t=compareNumbers){for(let e=0;e<this.columns;e++)this.setColumn(e,this.getColumn(e).sort(t));return this}subMatrix(t,e,r,s){checkRange(this,t,e,r,s);let o=new Matrix(e-t+1,s-r+1);for(let i=t;i<=e;i++)for(let e=r;e<=s;e++)o.set(i-t,e-r,this.get(i,e));return o}subMatrixRow(t,e,r){if(void 0===e&&(e=0),void 0===r&&(r=this.columns-1),e>r||e<0||e>=this.columns||r<0||r>=this.columns)throw new RangeError("Argument out of range");let s=new Matrix(t.length,r-e+1);for(let o=0;o<t.length;o++)for(let i=e;i<=r;i++){if(t[o]<0||t[o]>=this.rows)throw new RangeError(`Row index out of range: ${t[o]}`);s.set(o,i-e,this.get(t[o],i))}return s}subMatrixColumn(t,e,r){if(void 0===e&&(e=0),void 0===r&&(r=this.rows-1),e>r||e<0||e>=this.rows||r<0||r>=this.rows)throw new RangeError("Argument out of range");let s=new Matrix(r-e+1,t.length);for(let o=0;o<t.length;o++)for(let i=e;i<=r;i++){if(t[o]<0||t[o]>=this.columns)throw new RangeError(`Column index out of range: ${t[o]}`);s.set(i-e,o,this.get(i,t[o]))}return s}setSubMatrix(t,e,r){if((t=Matrix.checkMatrix(t)).isEmpty())return this;checkRange(this,e,e+t.rows-1,r,r+t.columns-1);for(let s=0;s<t.rows;s++)for(let o=0;o<t.columns;o++)this.set(e+s,r+o,t.get(s,o));return this}selection(t,e){let r=checkIndices(this,t,e),s=new Matrix(t.length,e.length);for(let t=0;t<r.row.length;t++){let e=r.row[t];for(let o=0;o<r.column.length;o++){let i=r.column[o];s.set(t,o,this.get(e,i))}}return s}trace(){let t=Math.min(this.rows,this.columns),e=0;for(let r=0;r<t;r++)e+=this.get(r,r);return e}clone(){let t=new Matrix(this.rows,this.columns);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)t.set(e,r,this.get(e,r));return t}sum(t){switch(t){case"row":return sumByRow(this);case"column":return sumByColumn(this);case void 0:return sumAll(this);default:throw new Error(`invalid option: ${t}`)}}product(t){switch(t){case"row":return productByRow(this);case"column":return productByColumn(this);case void 0:return productAll(this);default:throw new Error(`invalid option: ${t}`)}}mean(t){const e=this.sum(t);switch(t){case"row":for(let t=0;t<this.rows;t++)e[t]/=this.columns;return e;case"column":for(let t=0;t<this.columns;t++)e[t]/=this.rows;return e;case void 0:return e/this.size;default:throw new Error(`invalid option: ${t}`)}}variance(t,e={}){if("object"==typeof t&&(e=t,t=void 0),"object"!=typeof e)throw new TypeError("options must be an object");const{unbiased:r=!0,mean:s=this.mean(t)}=e;if("boolean"!=typeof r)throw new TypeError("unbiased must be a boolean");switch(t){case"row":if(!Array.isArray(s))throw new TypeError("mean must be an array");return varianceByRow(this,r,s);case"column":if(!Array.isArray(s))throw new TypeError("mean must be an array");return varianceByColumn(this,r,s);case void 0:if("number"!=typeof s)throw new TypeError("mean must be a number");return varianceAll(this,r,s);default:throw new Error(`invalid option: ${t}`)}}standardDeviation(t,e){"object"==typeof t&&(e=t,t=void 0);const r=this.variance(t,e);if(void 0===t)return Math.sqrt(r);for(let t=0;t<r.length;t++)r[t]=Math.sqrt(r[t]);return r}center(t,e={}){if("object"==typeof t&&(e=t,t=void 0),"object"!=typeof e)throw new TypeError("options must be an object");const{center:r=this.mean(t)}=e;switch(t){case"row":if(!Array.isArray(r))throw new TypeError("center must be an array");return centerByRow(this,r),this;case"column":if(!Array.isArray(r))throw new TypeError("center must be an array");return centerByColumn(this,r),this;case void 0:if("number"!=typeof r)throw new TypeError("center must be a number");return centerAll(this,r),this;default:throw new Error(`invalid option: ${t}`)}}scale(t,e={}){if("object"==typeof t&&(e=t,t=void 0),"object"!=typeof e)throw new TypeError("options must be an object");let r=e.scale;switch(t){case"row":if(void 0===r)r=getScaleByRow(this);else if(!Array.isArray(r))throw new TypeError("scale must be an array");return scaleByRow(this,r),this;case"column":if(void 0===r)r=getScaleByColumn(this);else if(!Array.isArray(r))throw new TypeError("scale must be an array");return scaleByColumn(this,r),this;case void 0:if(void 0===r)r=getScaleAll(this);else if("number"!=typeof r)throw new TypeError("scale must be a number");return scaleAll(this,r),this;default:throw new Error(`invalid option: ${t}`)}}toString(t){return inspectMatrixWithOptions(this,t)}}function compareNumbers(t,e){return t-e}AbstractMatrix.prototype.klass="Matrix","undefined"!=typeof Symbol&&(AbstractMatrix.prototype[Symbol.for("nodejs.util.inspect.custom")]=inspectMatrix),AbstractMatrix.random=AbstractMatrix.rand,AbstractMatrix.randomInt=AbstractMatrix.randInt,AbstractMatrix.diagonal=AbstractMatrix.diag,AbstractMatrix.prototype.diagonal=AbstractMatrix.prototype.diag,AbstractMatrix.identity=AbstractMatrix.eye,AbstractMatrix.prototype.negate=AbstractMatrix.prototype.neg,AbstractMatrix.prototype.tensorProduct=AbstractMatrix.prototype.kroneckerProduct;class Matrix extends AbstractMatrix{constructor(t,e){if(super(),Matrix.isMatrix(t))return t.clone();if(Number.isInteger(t)&&t>=0){if(this.data=[],!(Number.isInteger(e)&&e>=0))throw new TypeError("nColumns must be a positive integer");for(let r=0;r<t;r++)this.data.push(new Float64Array(e))}else{if(!Array.isArray(t))throw new TypeError("First argument must be a positive number or an array");{const r=t;if("number"!=typeof(e=(t=r.length)?r[0].length:0))throw new TypeError("Data must be a 2D array with at least one element");this.data=[];for(let s=0;s<t;s++){if(r[s].length!==e)throw new RangeError("Inconsistent array dimensions");this.data.push(Float64Array.from(r[s]))}}}this.rows=t,this.columns=e}set(t,e,r){return this.data[t][e]=r,this}get(t,e){return this.data[t][e]}removeRow(t){return checkRowIndex(this,t),this.data.splice(t,1),this.rows-=1,this}addRow(t,e){return void 0===e&&(e=t,t=this.rows),checkRowIndex(this,t,!0),e=Float64Array.from(checkRowVector(this,e)),this.data.splice(t,0,e),this.rows+=1,this}removeColumn(t){checkColumnIndex(this,t);for(let e=0;e<this.rows;e++){const r=new Float64Array(this.columns-1);for(let s=0;s<t;s++)r[s]=this.data[e][s];for(let s=t+1;s<this.columns;s++)r[s-1]=this.data[e][s];this.data[e]=r}return this.columns-=1,this}addColumn(t,e){void 0===e&&(e=t,t=this.columns),checkColumnIndex(this,t,!0),e=checkColumnVector(this,e);for(let r=0;r<this.rows;r++){const s=new Float64Array(this.columns+1);let o=0;for(;o<t;o++)s[o]=this.data[r][o];for(s[o++]=e[r];o<this.columns+1;o++)s[o]=this.data[r][o-1];this.data[r]=s}return this.columns+=1,this}}installMathOperations(AbstractMatrix,Matrix);const indent=" ".repeat(2),indentData=" ".repeat(4);function inspectMatrix(){return inspectMatrixWithOptions(this)}function inspectMatrixWithOptions(t,e={}){const{maxRows:r=15,maxColumns:s=10,maxNumSize:o=8}=e;return`${t.constructor.name} {\n${indent}[\n${indentData}${inspectData(t,r,s,o)}\n${indent}]\n${indent}rows: ${t.rows}\n${indent}columns: ${t.columns}\n}`}function inspectData(t,e,r,s){const{rows:o,columns:i}=t,n=Math.min(o,e),h=Math.min(i,r),l=[];for(let e=0;e<n;e++){let r=[];for(let o=0;o<h;o++)r.push(formatNumber(t.get(e,o),s));l.push(`${r.join(" ")}`)}return h!==i&&(l[l.length-1]+=` ... ${i-r} more columns`),n!==o&&l.push(`... ${o-e} more rows`),l.join(`\n${indentData}`)}function formatNumber(t,e){const r=String(t);if(r.length<=e)return r.padEnd(e," ");const s=t.toPrecision(e-2);if(s.length<=e)return s;const o=t.toExponential(e-2),i=o.indexOf("e"),n=o.slice(i);return o.slice(0,e-n.length)+n}function installMathOperations(t,e){t.prototype.add=function(t){return"number"==typeof t?this.addS(t):this.addM(t)},t.prototype.addS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)+t);return this},t.prototype.addM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)+t.get(e,r));return this},t.add=function(t,r){return new e(t).add(r)},t.prototype.sub=function(t){return"number"==typeof t?this.subS(t):this.subM(t)},t.prototype.subS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)-t);return this},t.prototype.subM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)-t.get(e,r));return this},t.sub=function(t,r){return new e(t).sub(r)},t.prototype.subtract=t.prototype.sub,t.prototype.subtractS=t.prototype.subS,t.prototype.subtractM=t.prototype.subM,t.subtract=t.sub,t.prototype.mul=function(t){return"number"==typeof t?this.mulS(t):this.mulM(t)},t.prototype.mulS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)*t);return this},t.prototype.mulM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)*t.get(e,r));return this},t.mul=function(t,r){return new e(t).mul(r)},t.prototype.multiply=t.prototype.mul,t.prototype.multiplyS=t.prototype.mulS,t.prototype.multiplyM=t.prototype.mulM,t.multiply=t.mul,t.prototype.div=function(t){return"number"==typeof t?this.divS(t):this.divM(t)},t.prototype.divS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)/t);return this},t.prototype.divM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)/t.get(e,r));return this},t.div=function(t,r){return new e(t).div(r)},t.prototype.divide=t.prototype.div,t.prototype.divideS=t.prototype.divS,t.prototype.divideM=t.prototype.divM,t.divide=t.div,t.prototype.mod=function(t){return"number"==typeof t?this.modS(t):this.modM(t)},t.prototype.modS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)%t);return this},t.prototype.modM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)%t.get(e,r));return this},t.mod=function(t,r){return new e(t).mod(r)},t.prototype.modulus=t.prototype.mod,t.prototype.modulusS=t.prototype.modS,t.prototype.modulusM=t.prototype.modM,t.modulus=t.mod,t.prototype.and=function(t){return"number"==typeof t?this.andS(t):this.andM(t)},t.prototype.andS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)&t);return this},t.prototype.andM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)&t.get(e,r));return this},t.and=function(t,r){return new e(t).and(r)},t.prototype.or=function(t){return"number"==typeof t?this.orS(t):this.orM(t)},t.prototype.orS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)|t);return this},t.prototype.orM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)|t.get(e,r));return this},t.or=function(t,r){return new e(t).or(r)},t.prototype.xor=function(t){return"number"==typeof t?this.xorS(t):this.xorM(t)},t.prototype.xorS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)^t);return this},t.prototype.xorM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)^t.get(e,r));return this},t.xor=function(t,r){return new e(t).xor(r)},t.prototype.leftShift=function(t){return"number"==typeof t?this.leftShiftS(t):this.leftShiftM(t)},t.prototype.leftShiftS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)<<t);return this},t.prototype.leftShiftM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)<<t.get(e,r));return this},t.leftShift=function(t,r){return new e(t).leftShift(r)},t.prototype.signPropagatingRightShift=function(t){return"number"==typeof t?this.signPropagatingRightShiftS(t):this.signPropagatingRightShiftM(t)},t.prototype.signPropagatingRightShiftS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)>>t);return this},t.prototype.signPropagatingRightShiftM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)>>t.get(e,r));return this},t.signPropagatingRightShift=function(t,r){return new e(t).signPropagatingRightShift(r)},t.prototype.rightShift=function(t){return"number"==typeof t?this.rightShiftS(t):this.rightShiftM(t)},t.prototype.rightShiftS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)>>>t);return this},t.prototype.rightShiftM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)>>>t.get(e,r));return this},t.rightShift=function(t,r){return new e(t).rightShift(r)},t.prototype.zeroFillRightShift=t.prototype.rightShift,t.prototype.zeroFillRightShiftS=t.prototype.rightShiftS,t.prototype.zeroFillRightShiftM=t.prototype.rightShiftM,t.zeroFillRightShift=t.rightShift,t.prototype.not=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,~this.get(t,e));return this},t.not=function(t){return new e(t).not()},t.prototype.abs=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.abs(this.get(t,e)));return this},t.abs=function(t){return new e(t).abs()},t.prototype.acos=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.acos(this.get(t,e)));return this},t.acos=function(t){return new e(t).acos()},t.prototype.acosh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.acosh(this.get(t,e)));return this},t.acosh=function(t){return new e(t).acosh()},t.prototype.asin=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.asin(this.get(t,e)));return this},t.asin=function(t){return new e(t).asin()},t.prototype.asinh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.asinh(this.get(t,e)));return this},t.asinh=function(t){return new e(t).asinh()},t.prototype.atan=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.atan(this.get(t,e)));return this},t.atan=function(t){return new e(t).atan()},t.prototype.atanh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.atanh(this.get(t,e)));return this},t.atanh=function(t){return new e(t).atanh()},t.prototype.cbrt=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.cbrt(this.get(t,e)));return this},t.cbrt=function(t){return new e(t).cbrt()},t.prototype.ceil=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.ceil(this.get(t,e)));return this},t.ceil=function(t){return new e(t).ceil()},t.prototype.clz32=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.clz32(this.get(t,e)));return this},t.clz32=function(t){return new e(t).clz32()},t.prototype.cos=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.cos(this.get(t,e)));return this},t.cos=function(t){return new e(t).cos()},t.prototype.cosh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.cosh(this.get(t,e)));return this},t.cosh=function(t){return new e(t).cosh()},t.prototype.exp=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.exp(this.get(t,e)));return this},t.exp=function(t){return new e(t).exp()},t.prototype.expm1=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.expm1(this.get(t,e)));return this},t.expm1=function(t){return new e(t).expm1()},t.prototype.floor=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.floor(this.get(t,e)));return this},t.floor=function(t){return new e(t).floor()},t.prototype.fround=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.fround(this.get(t,e)));return this},t.fround=function(t){return new e(t).fround()},t.prototype.log=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.log(this.get(t,e)));return this},t.log=function(t){return new e(t).log()},t.prototype.log1p=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.log1p(this.get(t,e)));return this},t.log1p=function(t){return new e(t).log1p()},t.prototype.log10=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.log10(this.get(t,e)));return this},t.log10=function(t){return new e(t).log10()},t.prototype.log2=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.log2(this.get(t,e)));return this},t.log2=function(t){return new e(t).log2()},t.prototype.round=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.round(this.get(t,e)));return this},t.round=function(t){return new e(t).round()},t.prototype.sign=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.sign(this.get(t,e)));return this},t.sign=function(t){return new e(t).sign()},t.prototype.sin=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.sin(this.get(t,e)));return this},t.sin=function(t){return new e(t).sin()},t.prototype.sinh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.sinh(this.get(t,e)));return this},t.sinh=function(t){return new e(t).sinh()},t.prototype.sqrt=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.sqrt(this.get(t,e)));return this},t.sqrt=function(t){return new e(t).sqrt()},t.prototype.tan=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.tan(this.get(t,e)));return this},t.tan=function(t){return new e(t).tan()},t.prototype.tanh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.tanh(this.get(t,e)));return this},t.tanh=function(t){return new e(t).tanh()},t.prototype.trunc=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.trunc(this.get(t,e)));return this},t.trunc=function(t){return new e(t).trunc()},t.pow=function(t,r){return new e(t).pow(r)},t.prototype.pow=function(t){return"number"==typeof t?this.powS(t):this.powM(t)},t.prototype.powS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,Math.pow(this.get(e,r),t));return this},t.prototype.powM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,Math.pow(this.get(e,r),t.get(e,r)));return this}}function sumByRow(t){let e=newArray(t.rows);for(let r=0;r<t.rows;++r)for(let s=0;s<t.columns;++s)e[r]+=t.get(r,s);return e}function sumByColumn(t){let e=newArray(t.columns);for(let r=0;r<t.rows;++r)for(let s=0;s<t.columns;++s)e[s]+=t.get(r,s);return e}function sumAll(t){let e=0;for(let r=0;r<t.rows;r++)for(let s=0;s<t.columns;s++)e+=t.get(r,s);return e}function productByRow(t){let e=newArray(t.rows,1);for(let r=0;r<t.rows;++r)for(let s=0;s<t.columns;++s)e[r]*=t.get(r,s);return e}function productByColumn(t){let e=newArray(t.columns,1);for(let r=0;r<t.rows;++r)for(let s=0;s<t.columns;++s)e[s]*=t.get(r,s);return e}function productAll(t){let e=1;for(let r=0;r<t.rows;r++)for(let s=0;s<t.columns;s++)e*=t.get(r,s);return e}function varianceByRow(t,e,r){const s=t.rows,o=t.columns,i=[];for(let n=0;n<s;n++){let s=0,h=0,l=0;for(let e=0;e<o;e++)s+=l=t.get(n,e)-r[n],h+=l*l;e?i.push((h-s*s/o)/(o-1)):i.push((h-s*s/o)/o)}return i}function varianceByColumn(t,e,r){const s=t.rows,o=t.columns,i=[];for(let n=0;n<o;n++){let o=0,h=0,l=0;for(let e=0;e<s;e++)o+=l=t.get(e,n)-r[n],h+=l*l;e?i.push((h-o*o/s)/(s-1)):i.push((h-o*o/s)/s)}return i}function varianceAll(t,e,r){const s=t.rows,o=t.columns,i=s*o;let n=0,h=0,l=0;for(let e=0;e<s;e++)for(let s=0;s<o;s++)n+=l=t.get(e,s)-r,h+=l*l;return e?(h-n*n/i)/(i-1):(h-n*n/i)/i}function centerByRow(t,e){for(let r=0;r<t.rows;r++)for(let s=0;s<t.columns;s++)t.set(r,s,t.get(r,s)-e[r])}function centerByColumn(t,e){for(let r=0;r<t.rows;r++)for(let s=0;s<t.columns;s++)t.set(r,s,t.get(r,s)-e[s])}function centerAll(t,e){for(let r=0;r<t.rows;r++)for(let s=0;s<t.columns;s++)t.set(r,s,t.get(r,s)-e)}function getScaleByRow(t){const e=[];for(let r=0;r<t.rows;r++){let s=0;for(let e=0;e<t.columns;e++)s+=Math.pow(t.get(r,e),2)/(t.columns-1);e.push(Math.sqrt(s))}return e}function scaleByRow(t,e){for(let r=0;r<t.rows;r++)for(let s=0;s<t.columns;s++)t.set(r,s,t.get(r,s)/e[r])}function getScaleByColumn(t){const e=[];for(let r=0;r<t.columns;r++){let s=0;for(let e=0;e<t.rows;e++)s+=Math.pow(t.get(e,r),2)/(t.rows-1);e.push(Math.sqrt(s))}return e}function scaleByColumn(t,e){for(let r=0;r<t.rows;r++)for(let s=0;s<t.columns;s++)t.set(r,s,t.get(r,s)/e[s])}function getScaleAll(t){const e=t.size-1;let r=0;for(let s=0;s<t.columns;s++)for(let o=0;o<t.rows;o++)r+=Math.pow(t.get(o,s),2)/e;return Math.sqrt(r)}function scaleAll(t,e){for(let r=0;r<t.rows;r++)for(let s=0;s<t.columns;s++)t.set(r,s,t.get(r,s)/e)}function checkRowIndex(t,e,r){let s=r?t.rows:t.rows-1;if(e<0||e>s)throw new RangeError("Row index out of range")}function checkColumnIndex(t,e,r){let s=r?t.columns:t.columns-1;if(e<0||e>s)throw new RangeError("Column index out of range")}function checkRowVector(t,e){if(e.to1DArray&&(e=e.to1DArray()),e.length!==t.columns)throw new RangeError("vector size must be the same as the number of columns");return e}function checkColumnVector(t,e){if(e.to1DArray&&(e=e.to1DArray()),e.length!==t.rows)throw new RangeError("vector size must be the same as the number of rows");return e}function checkIndices(t,e,r){return{row:checkRowIndices(t,e),column:checkColumnIndices(t,r)}}function checkRowIndices(t,e){if("object"!=typeof e)throw new TypeError("unexpected type for row indices");if(e.some(e=>e<0||e>=t.rows))throw new RangeError("row indices are out of range");return Array.isArray(e)||(e=Array.from(e)),e}function checkColumnIndices(t,e){if("object"!=typeof e)throw new TypeError("unexpected type for column indices");if(e.some(e=>e<0||e>=t.columns))throw new RangeError("column indices are out of range");return Array.isArray(e)||(e=Array.from(e)),e}function checkRange(t,e,r,s,o){if(5!==arguments.length)throw new RangeError("expected 4 arguments");if(checkNumber("startRow",e),checkNumber("endRow",r),checkNumber("startColumn",s),checkNumber("endColumn",o),e>r||s>o||e<0||e>=t.rows||r<0||r>=t.rows||s<0||s>=t.columns||o<0||o>=t.columns)throw new RangeError("Submatrix indices are out of range")}function newArray(t,e=0){let r=[];for(let s=0;s<t;s++)r.push(e);return r}function checkNumber(t,e){if("number"!=typeof e)throw new TypeError(`${t} must be a number`)}function checkNonEmpty(t){if(t.isEmpty())throw new Error("Empty matrix has no elements to index")}var svmjs=function(t){var e=function(t){};function r(t){return function(e,r){for(var s=0,o=0;o<e.length;o++)s+=(e[o]-r[o])*(e[o]-r[o]);return Math.exp(-s/(2*t*t))}}function s(t,e){for(var r=0,s=0;s<t.length;s++)r+=t[s]*e[s];return r}return e.prototype={train:function(t,e,o){this.data=t,this.labels=e;var i=(o=o||{}).C||1,n=o.tol||1e-4,h=o.alphatol||1e-7,l=o.maxiter||1e4,a=o.numpasses||10,u=s;if(this.kernelType="linear","kernel"in o)if("string"==typeof o.kernel){if("linear"===o.kernel&&(this.kernelType="linear",u=s),"rbf"===o.kernel){var c=o.rbfsigma||.5;this.rbfSigma=c,this.kernelType="rbf",u=r(c)}}else this.kernelType="custom",u=o.kernel;this.kernel=u,this.N=t.length;var f=this.N;this.D=t[0].length;this.D;if(this.alpha=function(t){for(var e=new Array(t),r=0;r<t;r++)e[r]=0;return e}(f),this.b=0,this.usew_=!1,o.memoize){this.kernelResults=new Array(f);for(var m=0;m<f;m++){this.kernelResults[m]=new Array(f);for(var w=0;w<f;w++)this.kernelResults[m][w]=u(t[m],t[w])}}for(var p,g,d=0,y=0;y<a&&d<l;){var M=0;for(m=0;m<f;m++){var b=this.marginOne(t[m])-e[m];if(e[m]*b<-n&&this.alpha[m]<i||e[m]*b>n&&this.alpha[m]>0){for(w=m;w===m;)p=0,g=this.N,w=Math.floor(Math.random()*(g-p)+p);var x=this.marginOne(t[w])-e[w];ai=this.alpha[m],aj=this.alpha[w];var v=0,R=i;if(e[m]===e[w]?(v=Math.max(0,ai+aj-i),R=Math.min(i,ai+aj)):(v=Math.max(0,aj-ai),R=Math.min(i,i+aj-ai)),Math.abs(v-R)<1e-4)continue;var k=2*this.kernelResult(m,w)-this.kernelResult(m,m)-this.kernelResult(w,w);if(k>=0)continue;var S=aj-e[w]*(b-x)/k;if(S>R&&(S=R),S<v&&(S=v),Math.abs(aj-S)<1e-4)continue;this.alpha[w]=S;var A=ai+e[m]*e[w]*(aj-S);this.alpha[m]=A;var E=this.b-b-e[m]*(A-ai)*this.kernelResult(m,m)-e[w]*(S-aj)*this.kernelResult(m,w),C=this.b-x-e[m]*(A-ai)*this.kernelResult(m,w)-e[w]*(S-aj)*this.kernelResult(w,w);this.b=.5*(E+C),A>0&&A<i&&(this.b=E),S>0&&S<i&&(this.b=C),M++}}d++,0==M?y++:y=0}if("linear"===this.kernelType){this.w=new Array(this.D);for(w=0;w<this.D;w++){var N=0;for(m=0;m<this.N;m++)N+=this.alpha[m]*e[m]*t[m][w];this.w[w]=N,this.usew_=!0}}else{var I=[],T=[],V=[];for(m=0;m<this.N;m++)this.alpha[m]>h&&(I.push(this.data[m]),T.push(this.labels[m]),V.push(this.alpha[m]));this.data=I,this.labels=T,this.alpha=V,this.N=this.data.length}var D={};return D.iters=d,D},marginOne:function(t){var e=this.b;if(this.usew_)for(var r=0;r<this.D;r++)e+=t[r]*this.w[r];else for(var s=0;s<this.N;s++)e+=this.alpha[s]*this.labels[s]*this.kernel(t,this.data[s]);return e},predictOne:function(t){return this.marginOne(t)>0?1:-1},margins:function(t){for(var e=t.length,r=new Array(e),s=0;s<e;s++)r[s]=this.marginOne(t[s]);return r},kernelResult:function(t,e){return this.kernelResults?this.kernelResults[t][e]:this.kernel(this.data[t],this.data[e])},predict:function(t){for(var e=this.margins(t),r=0;r<e.length;r++)e[r]=e[r]>0?1:-1;return e},getWeights:function(){for(var t=new Array(this.D),e=0;e<this.D;e++){for(var r=0,s=0;s<this.N;s++)r+=this.alpha[s]*this.labels[s]*this.data[s][e];t[e]=r}return{w:t,b:this.b}},toJSON:function(){return"custom"===this.kernelType?(console.log("Can't save this SVM because it's using custom, unsupported kernel..."),{}):(json={},json.N=this.N,json.D=this.D,json.b=this.b,json.kernelType=this.kernelType,"linear"===this.kernelType&&(json.w=this.w),"rbf"===this.kernelType&&(json.rbfSigma=this.rbfSigma,json.data=this.data,json.labels=this.labels,json.alpha=this.alpha),json)},fromJSON:function(t){this.N=t.N,this.D=t.D,this.b=t.b,this.kernelType=t.kernelType,"linear"===this.kernelType?(this.w=t.w,this.usew_=!0,this.kernel=s):"rbf"==this.kernelType?(this.rbfSigma=t.rbfSigma,this.kernel=r(this.rbfSigma),this.data=t.data,this.labels=t.labels,this.alpha=t.alpha):console.log("ERROR! unrecognized kernel type."+this.kernelType)}},(t=t||{}).SVM=e,t.makeRbfKernel=r,t.linearKernel=s,t}("undefined"!=typeof module&&module.exports);
class KMeans{constructor(){this.k=3}}class LinearKMeans extends KMeans{constructor(){super(),this.data=[]}clusterize(t,a,e){let r=[];this.data=a;for(let n=0;n<e;n++){let e=[];for(let r=0;r<t;r++){let t=a[Math.floor(Math.random()*a.length)];for(;-1!=e.findIndex(a=>a===t);)t=a[Math.floor(Math.random()*a.length)];e.push(t)}e=e.sort(function(t,a){return t>a?1:a>t?-1:0});let n=[],s=[],h=0,i=0,c=!0;a.forEach(t=>{h=0,i=0,c=!0,e.forEach(a=>{let e=this.distance(t,a);c?(i=Math.abs(e),h=a,c=!c):Math.abs(e)<i&&(i=Math.abs(e),h=a),n.push([t,a,e])}),s.push([t,h,i])});let u=[],l=0,o=[];do{u=o,o=[],l=0,e.forEach((t,a)=>{let r=s.filter(a=>a[1]==t).map(t=>t[0]);o.push(this.calculateMeanVariance(r)),l+=r[1],e[a]=o[a][0]}),Number.isNaN(l)&&(l=0),n=[],s=[],h=0,i=0,c=!0,a.forEach(t=>{h=0,i=0,c=!0,e.forEach(a=>{let e=this.distance(t,a);c?(i=Math.abs(e),h=a,c=!c):Math.abs(e)<i&&(i=Math.abs(e),h=a),n.push([t,a,e])}),s.push([t,h,i])})}while(JSON.stringify(u)!=JSON.stringify(o));r.push([l,e,s])}return r.sort(function(t,a){return t[0]>a[0]?1:a[0]>t[0]?-1:0}),r[0][2]}distance(t,a){return a-t}calculateMeanVariance(t){var a=t.reduce(function(t,a){return t+a}),e=function(t,a){return t.reduce(function(t,e){return t+=Math.pow(e-a,2)},0)}(t,a/t.length),r={mean:a/t.length,variance:e/t.length};return[r.mean,r.variance]}}class _2DKMeans extends KMeans{constructor(){super(),this.data=[]}clusterize(t,a,e){let r=[];this.data=a;for(let n=0;n<e;n++){let n=[];for(let e=0;e<t;e++){let t=a[Math.floor(Math.random()*a.length)];for(;-1!=n.findIndex(a=>a===t);)t=a[Math.floor(Math.random()*a.length)];n.push(t)}let s=[],h=[],i=[],c=0,u=!0;a.forEach(t=>{i=[0],c=0,u=!0,n.forEach(a=>{let e=this.distance(t,a);u?(c=Math.abs(e),i=a,u=!u):Math.abs(e)<c&&(c=Math.abs(e),i=a),s.push([t,a,e])}),h.push([t,i,c])});let l=[],o=0,f=[],M=0;do{l=f,f=[],o=0,n.forEach((t,a)=>{let e=h.filter(a=>JSON.stringify(a[1])==JSON.stringify(t)).map(t=>t[0]);f.push([this.calculateMeanVariance(e.map(t=>t[0])),this.calculateMeanVariance(e.map(t=>t[1]))]),o+=e[1],n[a]=f[a][0]}),Number.isNaN(o)&&(o=0),s=[],h=[],i=0,c=0,u=!0,a.forEach(t=>{i=0,c=0,u=!0,n.forEach(a=>{let e=this.distance(t,a);u?(c=Math.abs(e),i=a,u=!u):Math.abs(e)<c&&(c=Math.abs(e),i=a),s.push([t,a,e])}),h.push([t,i,c])}),M++}while(JSON.stringify(l)!=JSON.stringify(f)&&M<e);r.push([o,n,h])}return r.sort(function(t,a){return t[0]>a[0]?1:a[0]>t[0]?-1:0}),r[0][2]}distance(t,a){let e=t[0],r=t[1],n=a[0],s=a[1];return Math.sqrt(Math.pow(n-e,2)+Math.pow(s-r,2))}calculateMeanVariance(t){if(t.length<1)return[1e6,1e6];var a=t.reduce(function(t,a){return t+a}),e=function(t,a){return t.reduce(function(t,e){return t+=Math.pow(e-a,2)},0)}(t,a/t.length),r={mean:a/t.length,variance:e/t.length};return[r.mean,r.variance]}}
